<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>å®˜æ–¹æ´»åŠ¨</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="shortcut icon" type="image/png" href="logo.png">
</head>
<body>
  <nav class="navbar">
    <div class="container nav-grid">
      <a class="nav-brand" href="#top" data-i18n="brand"></a>
      <div class="nav-center">
        <a class="nav-home" href="#top" data-i18n="home"></a>
      </div>
      <div class="lang-switch">
        <button class="lang-toggle"><span class="lang-current">ä¸­æ–‡</span> <span class="lang-arrow">â–¼</span></button>
        <div class="lang-menu">
          <button class="lang-item" data-lang="zh">ä¸­æ–‡</button>
          <button class="lang-item" data-lang="en">English</button>
        </div>
      </div>
    </div>
  </nav>
  <header id="top" class="site-header">
    <div class="container">
      <h1 data-i18n="headerTitle"></h1>
      <p data-i18n="headerSubtitle"></p>
      <div class="filters">
        <button class="filter-chip chip-all" data-filter="all">å…¨éƒ¨</button>
        <button class="filter-chip chip-limited" data-filter="limited">é™æ—¶</button>
        <button class="filter-chip chip-permanent" data-filter="permanent">å¸¸é©»</button>
        <button class="filter-chip chip-completed" data-filter="completed">å®Œç»“</button>
      </div>
      <!-- å¤´éƒ¨å·¦å³è£…é¥°åŠ¨å›¾ï¼šæ¥è‡ª bg/bg1ï¼Œå·¦å³åŒºåŸŸæ¥å›ç§»åŠ¨ -->
      <div class="header-decor">
        <img class="decor decor-left" src="bg/bg1.gif" alt="è£…é¥°å·¦" />
        <img class="decor decor-right" src="bg/bg1.gif" alt="è£…é¥°å³" />
      </div>
    </div>
  </header>
  <main class="container">
    <div id="activity-grid" class="grid"></div>
  </main>
  <script>
    // å½“å‰è¯­è¨€ï¼Œé»˜è®¤ä¸­æ–‡
    let lang = localStorage.getItem('lang') || 'zh';
    // å¤´éƒ¨ä¸å¯¼èˆªæ–‡æ¡ˆï¼ˆä¸­è‹±ï¼‰
    const i18n = {
      zh: {
        brand: 'å“ˆåŸºç±³æ´»åŠ¨', home: 'é¦–é¡µ', headerTitle: 'å“ˆåŸºç±³æ´»åŠ¨', headerSubtitle: 'å“ˆåŸºç±³ç”Ÿæ€æ´»åŠ¨æ­£åœ¨è¿›è¡Œä¸­ï¼Œç‚¹å‡»ä¸‹æ–¹å¡ç‰‡è®¿é—®è¯¦æƒ…', from: 'èµ·',
        filters: { all: 'å…¨éƒ¨', limited: 'é™æ—¶', permanent: 'å¸¸é©»', completed: 'å®Œç»“' }
      },
      en: {
        brand: 'Hajimi Events', home: 'Home', headerTitle: 'Hajimi Events', headerSubtitle: 'Hajimi ecosystem events are ongoing. Click cards below for details', from: 'from',
        filters: { all: 'All', limited: 'Limited', permanent: 'Permanent', completed: 'Completed' }
      }
    };
    // æ´»åŠ¨æ•°æ®ï¼šæ”¯æŒå¼€å§‹/ç»“æŸæ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ï¼ŒçŠ¶æ€ï¼šé™æ—¶/å¸¸é©»/å®Œç»“
    const events = [
      { title: { zh: 'å“ˆåŸºç±³å”±æ­Œå¤§èµ›S1', en: 'Hajimi Singing Contest S1' }, description: { zh: 'æ¥å”±æ­ŒğŸ¤å§ï¼Œå“ˆåŸºç±³å¥½å£°éŸ³', en: 'Letâ€™s sing ğŸ¤ â€” Hajimi Voice' }, image: 'images/1.jpg', url: 'https://x.com/hajimi_CTO_BNB/status/1990643902249120255', start: '2025-11-18', end: '2025-11-21', status: 'completed' },
      { title: { zh: 'æ‹¯æ•‘æµæµªè®¡åˆ’', en: 'Rescue Stray Plan' }, description: { zh: 'ä½ çš„å–„ä¸¾ï¼Œä¸æ˜¯æ–½èˆï¼Œæ˜¯æ‹¯æ•‘ã€‚è®©æ¯ä¸€åªå°çŒ«ï¼Œéƒ½æ‹¥æœ‰è¢«çˆ±çš„æƒåˆ©ï¼', en: 'Your kindness is rescue, not charity. Every cat deserves love!' }, image: 'images/2.png', url: 'https://x.com/hajimi_fund/status/1987769574113382594', start: '2025-11-10', status: 'permanent' }
    ];
    // ä»æœ¬åœ°å­˜å‚¨è¯»å–ç”¨æˆ·æ–°å¢çš„æ´»åŠ¨
    function getUserEvents() {
      try {
        const raw = localStorage.getItem('user_events');
        if (!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch (_) { return []; }
    }
    // è¿œç¨‹ events.jsonï¼ˆéƒ¨ç½²åˆ°äº‘ç«¯æ—¶ç”¨äºåŒæ­¥æœ€æ–°æ´»åŠ¨ï¼‰
    let remoteEvents = null;
    async function fetchRemoteEvents() {
      try {
        const res = await fetch('events.json?v=' + Date.now(), { cache: 'no-store' });
        if (!res.ok) return;
        const data = await res.json();
        if (Array.isArray(data)) remoteEvents = data;
      } catch (_) { /* ç½‘ç»œå¼‚å¸¸åˆ™å¿½ç•¥ */ }
    }
    // æ´»åŠ¨ç½‘æ ¼å®¹å™¨
    const grid = document.getElementById('activity-grid');
    function setTexts() {
      // è®¾ç½®å¸¦ data-i18n çš„å…ƒç´ æ–‡æœ¬
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const k = el.getAttribute('data-i18n');
        el.textContent = i18n[lang][k] || '';
      });
      // æ›´æ–°è¯­è¨€å¼€å…³æ˜¾ç¤º
      const current = document.querySelector('.lang-current');
      if (current) current.textContent = lang === 'zh' ? 'ä¸­æ–‡' : 'English';
      document.querySelectorAll('.lang-item').forEach(btn => {
        btn.classList.toggle('selected', btn.getAttribute('data-lang') === lang);
      });
      // æ›´æ–°ç­›é€‰æŒ‰é’®æ–‡æ¡ˆï¼ˆå…¨éƒ¨/é™æ—¶/å¸¸é©»/å®Œç»“ï¼‰
      const f = i18n[lang].filters;
      const chipAll = document.querySelector('.chip-all'); if (chipAll) chipAll.textContent = f.all;
      const chipLimited = document.querySelector('.chip-limited'); if (chipLimited) chipLimited.textContent = f.limited;
      const chipPermanent = document.querySelector('.chip-permanent'); if (chipPermanent) chipPermanent.textContent = f.permanent;
      const chipCompleted = document.querySelector('.chip-completed'); if (chipCompleted) chipCompleted.textContent = f.completed;
    }
    // çŠ¶æ€æ ‡ç­¾æ–‡æ¡ˆ
    const statusText = {
      zh: { permanent: 'å¸¸é©»', limited: 'é™æ—¶', completed: 'å®Œç»“' },
      en: { permanent: 'Permanent', limited: 'Limited', completed: 'Completed' }
    };
    // è§£æåŒ—äº¬æ—¶é—´åˆ°æ¯«ç§’æ—¶é—´æˆ³ï¼ˆä»…æ—¥æœŸåˆ™æŒ‰ 00:00ï¼‰
    function parseBJ(dateStr) {
      if (!dateStr) return null;
      const s = String(dateStr).trim();
      const parts = s.split(/\s+/);
      const d = parts[0].replace(/\//g, '-');
      const t = parts[1] ? parts[1] : '00:00';
      const iso = `${d}T${t}:00+08:00`;
      const ms = Date.parse(iso);
      return Number.isFinite(ms) ? ms : null;
    }
    // è®¡ç®—åŠ¨æ€çŠ¶æ€ï¼šè¶…è¿‡ç»“æŸæ—¶é—´åˆ™è§†ä¸ºå®Œç»“
    function effectiveStatus(item, nowMs) {
      const endMs = parseBJ(item.end);
      if (endMs && nowMs >= endMs) return 'completed';
      return item.status;
    }
    // æ ¼å¼åŒ–æ˜¾ç¤ºä¸º YYYY/MM/DDï¼ˆä¸å«æ—¶é—´ï¼‰
    function fmtFull(d) {
      if (!d) return '';
      const dt = new Date(d);
      const y = dt.getFullYear();
      const m = String(dt.getMonth()+1).padStart(2,'0');
      const day = String(dt.getDate()).padStart(2,'0');
      return `${y}/${m}/${day}`;
    }
    function formatRange(start, end) {
      // ç»“æŸå­˜åœ¨åˆ™æ˜¾ç¤ºå®Œæ•´èŒƒå›´ï¼›å¦åˆ™æ˜¾ç¤ºâ€œèµ·â€
      const sFull = fmtFull(start);
      if (end) {
        const eFull = fmtFull(end);
        return `${sFull} - ${eFull}`;
      }
      return lang === 'zh' ? `${sFull}${i18n[lang].from}` : `${i18n[lang].from} ${sFull}`;
    }
    // æ¸²æŸ“å•å¼ å¡ç‰‡
    function renderCard(item) {
      const a = document.createElement('a');
      a.className = 'card';
      a.href = item.url;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.setAttribute('aria-label', item.title[lang]);
      const img = document.createElement('img');
      img.src = item.image;
      img.alt = item.title[lang];
      const content = document.createElement('div');
      content.className = 'card-content';
      const h3 = document.createElement('h3');
      h3.textContent = item.title[lang];
      const p = document.createElement('p');
      p.textContent = item.description[lang];
      const meta = document.createElement('div');
      meta.className = 'card-meta';
      meta.textContent = formatRange(item.start, item.end);
      // æ ¹æ®å½“å‰æ—¶é—´è®¡ç®—çŠ¶æ€å¹¶æ˜¾ç¤ºå¾½ç« 
      const nowMs = Date.now();
      const st = effectiveStatus(item, nowMs);
      const badge = document.createElement('div');
      badge.className = `badge badge-${st}`;
      badge.textContent = statusText[lang][st];
      content.appendChild(h3);
      content.appendChild(p);
      content.appendChild(meta);
      a.appendChild(img);
      a.appendChild(badge);
      a.appendChild(content);
      return a;
    }
    // å½“å‰ç­›é€‰çŠ¶æ€ä¸å†…å®¹é«˜åº¦åŸºçº¿
    let filterStatus = null;
    let baseContentHeight = 0;
    // æ’åºï¼šçŠ¶æ€ä¼˜å…ˆçº§ + åŒç±»æŒ‰å¼€å§‹æ—¶é—´æœ€è¿‘åœ¨å‰
    function sortEvents(list, nowMs) {
      const pri = { limited: 0, permanent: 1, completed: 2 };
      return list.slice().sort((a,b) => {
        const ap = pri[effectiveStatus(a, nowMs)], bp = pri[effectiveStatus(b, nowMs)];
        if (ap !== bp) return ap - bp;
        const ad = parseBJ(a.start) || 0;
        const bd = parseBJ(b.start) || 0;
        return bd - ad;
      });
    }
    function renderEvents() {
      // æ‰¹é‡æ¸²æŸ“ï¼Œä½¿ç”¨ DocumentFragment å‡å°‘é‡æ’
      grid.innerHTML = '';
      const nowMs = Date.now();
      const base = remoteEvents || [];
      const list = sortEvents((filterStatus ? base.filter(e => effectiveStatus(e, nowMs) === filterStatus) : base), nowMs);
      const frag = document.createDocumentFragment();
      list.forEach(e => frag.appendChild(renderCard(e)));
      grid.appendChild(frag);
      const h = equalizeCardContentHeights();
      if (!filterStatus) baseContentHeight = Math.max(baseContentHeight, h);
    }
    function setLang(l) {
      // åˆ‡æ¢è¯­è¨€å¹¶åˆ·æ–°é¡µé¢æ–‡æœ¬ä¸å¡ç‰‡
      lang = l;
      localStorage.setItem('lang', l);
      setTexts();
      renderEvents();
    }
    function equalizeCardContentHeights() {
      // ç»Ÿä¸€æ‰€æœ‰å¡ç‰‡å†…å®¹åŒºé«˜åº¦ï¼Œé¿å…ç­›é€‰æ—¶è·³åŠ¨
      const boxes = Array.from(document.querySelectorAll('.card-content'));
      boxes.forEach(b => { b.style.height = ''; });
      if (!boxes.length) return 0;
      const maxH = Math.max(...boxes.map(b => b.offsetHeight));
      const target = Math.max(baseContentHeight, maxH);
      boxes.forEach(b => { b.style.height = target + 'px'; });
      return target;
    }
    let resizeTimer;
    window.addEventListener('resize', () => {
      // é˜²æŠ–ï¼šçª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è®¡ç®—é«˜åº¦
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(equalizeCardContentHeights, 150);
    });
    const switchEl = document.querySelector('.lang-switch');
    const toggleEl = document.querySelector('.lang-toggle');
    toggleEl.addEventListener('click', () => {
      // è¯­è¨€èœå•å±•å¼€/æ”¶èµ·
      switchEl.classList.toggle('open');
    });
    document.addEventListener('click', (e) => {
      // ç‚¹å‡»èœå•å¤–éƒ¨æ”¶èµ·
      if (!switchEl.contains(e.target)) { switchEl.classList.remove('open'); }
    });
    document.querySelectorAll('.lang-item').forEach(btn => {
      btn.addEventListener('click', () => {
        // é€‰æ‹©è¯­è¨€å¹¶æ”¶èµ·èœå•
        setLang(btn.getAttribute('data-lang'));
        switchEl.classList.remove('open');
      });
    });
    const chips = Array.from(document.querySelectorAll('.filter-chip'));
    chips.forEach(chip => {
      chip.addEventListener('click', () => {
        chip.classList.add('feedback');
        setTimeout(() => { chip.classList.remove('feedback'); }, 400);
        const val = chip.getAttribute('data-filter');
        if (val === 'all') {
          filterStatus = null;
          chips.forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
        } else if (filterStatus === val) {
          filterStatus = null;
          chips.forEach(c => c.classList.remove('active'));
          const allChip = document.querySelector('.chip-all');
          if (allChip) allChip.classList.add('active');
        } else {
          filterStatus = val;
          chips.forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
        }
        // åˆ‡æ¢ç­›é€‰åé‡æ–°æ¸²æŸ“ä¸å¯¹é½é«˜åº¦
        renderEvents();
      });
    });
    const allChip = document.querySelector('.chip-all');
    if (allChip) allChip.classList.add('active');
    fetchRemoteEvents().finally(() => { setLang(lang); });
    // æ¯åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡ï¼Œä»¥æ›´æ–°å®Œç»“çŠ¶æ€
    setInterval(renderEvents, 60000);
  </script>
</body>
</html>
